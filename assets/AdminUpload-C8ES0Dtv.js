import{d as e,n as t,o as n,r,t as i}from"./adminService-bkkylZxw.js";import{c as a}from"./chunk-4WY6JWTD-BE6XXGqj.js";import{a as o,n as s,o as c,r as l,t as u,u as d}from"./MultiSelect-BFs7KGlr.js";var f=e(n(),1),p={uploadContainer:`_uploadContainer_jgpdn_3`,uploadCard:`_uploadCard_jgpdn_19`,header:`_header_jgpdn_45`,headerIcon:`_headerIcon_jgpdn_55`,errorMessage:`_errorMessage_jgpdn_103`,slideDown:`_slideDown_jgpdn_1`,successMessage:`_successMessage_jgpdn_127`,form:`_form_jgpdn_175`,fileSection:`_fileSection_jgpdn_189`,fileLabel:`_fileLabel_jgpdn_201`,fileUploadBox:`_fileUploadBox_jgpdn_221`,fileInput:`_fileInput_jgpdn_259`,uploadIcon:`_uploadIcon_jgpdn_267`,filePreview:`_filePreview_jgpdn_305`,fadeIn:`_fadeIn_jgpdn_1`,fileInfo:`_fileInfo_jgpdn_337`,fileName:`_fileName_jgpdn_347`,fileSize:`_fileSize_jgpdn_367`,removeBtn:`_removeBtn_jgpdn_379`,imagePreview:`_imagePreview_jgpdn_421`,inputGroup:`_inputGroup_jgpdn_489`,input:`_input_jgpdn_489`,select:`_select_jgpdn_515`,inputRow:`_inputRow_jgpdn_583`,actions:`_actions_jgpdn_597`,cancelBtn:`_cancelBtn_jgpdn_609`,submitBtn:`_submitBtn_jgpdn_611`,spinner:`_spinner_jgpdn_709`,spin:`_spin_jgpdn_709`,errorContainer:`_errorContainer_jgpdn_729`,backBtn:`_backBtn_jgpdn_775`},m=e(r(),1),h=()=>{let e=a(),{user:n}=d(),[r,h]=(0,f.useState)({title:``,artistId:``,genreIds:[],releaseYear:new Date().getFullYear(),duration:0}),[g,_]=(0,f.useState)(null),[v,y]=(0,f.useState)(null),[b,x]=(0,f.useState)(!1),[S,C]=(0,f.useState)(``),[w,T]=(0,f.useState)(``),[E,D]=(0,f.useState)([]),[O,k]=(0,f.useState)(!0),[A,j]=(0,f.useState)([]),[M,N]=(0,f.useState)(!0);(0,f.useEffect)(()=>{!n||n.accountType!==`ADMIN`||(async()=>{try{k(!0),N(!0);let[e,t]=await Promise.all([i.getAllGenres(),i.getArtistsForDropdown()]);D(e||[]),j(t||[])}catch(e){console.error(`Failed to load initial data:`,e),C(t(e)||`Failed to load data. Please refresh.`)}finally{k(!1),N(!1)}})()},[n]);let P=e=>{h(t=>({...t,[e.target.name]:e.target.value})),C(``)},F=e=>{let t=e.target.files[0];if(t){if(!t.type.startsWith(`audio/`)){C(`Please select a valid audio file`);return}if(t.size>50*1024*1024){C(`Audio file too large (max 50MB)`);return}_(t);let e=URL.createObjectURL(t);y(e);let n=new Audio(e);n.onloadedmetadata=()=>{h(e=>({...e,duration:Math.floor(n.duration)}))},C(``)}},I=()=>{v&&URL.revokeObjectURL(v),_(null),y(null),h(e=>({...e,duration:0}))};return n?n.accountType===`ADMIN`?(0,m.jsx)(`div`,{className:p.uploadContainer,children:(0,m.jsxs)(`div`,{className:p.uploadCard,children:[(0,m.jsxs)(`div`,{className:p.header,children:[(0,m.jsx)(l,{size:32,className:p.headerIcon}),(0,m.jsx)(`h1`,{children:`Admin Upload Song`}),(0,m.jsx)(`p`,{children:`Upload songs and assign to artists`})]}),S&&(0,m.jsx)(`div`,{className:p.errorMessage,children:S}),w&&(0,m.jsx)(`div`,{className:p.successMessage,children:w}),(0,m.jsxs)(`form`,{onSubmit:async e=>{if(e.preventDefault(),C(``),T(``),!g){C(`Please select an audio file`);return}if(!r.title.trim()){C(`Please enter song title`);return}if(!r.artistId){C(`Please select an artist`);return}if(!r.genreIds.length){C(`Please select at least one genre`);return}x(!0);try{await i.uploadSong({audioFile:g,title:r.title.trim(),artistId:r.artistId,genreIds:r.genreIds,releaseYear:r.releaseYear,duration:r.duration}),T(`Song uploaded successfully!`),setTimeout(()=>{I(),h({title:``,artistId:``,genreIds:[],releaseYear:new Date().getFullYear(),duration:0}),T(``)},1500)}catch(e){console.error(`Upload error:`,e),C(t(e)||`Failed to upload song`)}finally{x(!1)}},className:p.form,children:[(0,m.jsxs)(`div`,{className:p.fileSection,children:[(0,m.jsxs)(`label`,{className:p.fileLabel,children:[(0,m.jsx)(o,{size:20}),`Audio File *`]}),g?(0,m.jsxs)(`div`,{className:p.filePreview,children:[(0,m.jsx)(o,{size:24}),(0,m.jsxs)(`div`,{className:p.fileInfo,children:[(0,m.jsx)(`p`,{className:p.fileName,children:g.name}),(0,m.jsxs)(`p`,{className:p.fileSize,children:[(g.size/(1024*1024)).toFixed(2),` MB`,r.duration>0&&` â€¢ ${(e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,`0`)}`)(r.duration)}`]})]}),(0,m.jsx)(`button`,{type:`button`,onClick:I,className:p.removeBtn,"aria-label":`Remove audio file`,children:(0,m.jsx)(s,{size:20})})]}):(0,m.jsxs)(`label`,{className:p.fileUploadBox,children:[(0,m.jsx)(`input`,{type:`file`,accept:`audio/*`,onChange:F,className:p.fileInput}),(0,m.jsx)(l,{size:48,className:p.uploadIcon}),(0,m.jsx)(`p`,{children:`Click to upload or drag and drop`}),(0,m.jsx)(`span`,{children:`MP3, WAV, FLAC (max 50MB)`})]})]}),(0,m.jsxs)(`div`,{className:p.inputGroup,children:[(0,m.jsx)(`label`,{htmlFor:`title`,children:`Song Title *`}),(0,m.jsx)(`input`,{id:`title`,type:`text`,name:`title`,value:r.title,onChange:P,placeholder:`Enter song title`,className:p.input,required:!0,disabled:b})]}),(0,m.jsxs)(`div`,{className:p.inputGroup,children:[(0,m.jsx)(`label`,{htmlFor:`artistId`,children:`Artist *`}),(0,m.jsxs)(`select`,{id:`artistId`,name:`artistId`,value:r.artistId,onChange:P,className:p.input,disabled:b||M,children:[(0,m.jsx)(`option`,{value:``,children:M?`Loading artists...`:`Select artist`}),A.map(e=>(0,m.jsx)(`option`,{value:e.artistId,children:e.artistName},e.artistId))]})]}),(0,m.jsxs)(`div`,{className:p.inputRow,children:[(0,m.jsx)(`div`,{className:p.inputGroup,children:(0,m.jsx)(u,{label:`Genres *`,placeholder:O?`Loading genres...`:`Select genres`,values:r.genreIds,options:E.map(e=>({value:e.genreId??e.id,label:e.name})),disabled:b||O,onChange:e=>h(t=>({...t,genreIds:e}))})}),(0,m.jsxs)(`div`,{className:p.inputGroup,children:[(0,m.jsx)(`label`,{htmlFor:`releaseYear`,children:`Release Year`}),(0,m.jsx)(`input`,{id:`releaseYear`,type:`number`,name:`releaseYear`,value:r.releaseYear,onChange:P,min:`1900`,max:new Date().getFullYear(),className:p.input,disabled:b})]})]}),(0,m.jsxs)(`div`,{className:p.actions,children:[(0,m.jsx)(`button`,{type:`button`,onClick:()=>e(`/admin/dashboard`),className:p.cancelBtn,disabled:b,children:`Cancel`}),(0,m.jsx)(`button`,{type:`submit`,className:p.submitBtn,disabled:b||!g||O||M,children:b?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c,{size:20,className:p.spinner}),`Uploading...`]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(l,{size:20}),`Upload Song`]})})]})]})]})}):(0,m.jsxs)(`div`,{className:p.errorContainer,children:[(0,m.jsx)(`h2`,{children:`Access Denied`}),(0,m.jsx)(`p`,{children:`Only admins can upload songs here.`}),(0,m.jsx)(`button`,{onClick:()=>e(`/home`),className:p.backBtn,children:`Back to Home`})]}):(0,m.jsxs)(`div`,{className:p.errorContainer,children:[(0,m.jsx)(`h2`,{children:`Please Login`}),(0,m.jsx)(`p`,{children:`You need to be logged in to access this page.`}),(0,m.jsx)(`button`,{onClick:()=>e(`/auth`),className:p.backBtn,children:`Go to Login`})]})};export{h as default};